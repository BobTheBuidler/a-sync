<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>a_sync.utils.iterators &mdash; ez-a-sync  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ez-a-sync
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/modules.html">a_sync</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ez-a-sync</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../utils.html">a_sync.utils</a></li>
      <li class="breadcrumb-item active">a_sync.utils.iterators</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for a_sync.utils.iterators</h1><div class="highlight"><pre>
<span></span>
<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">asyncio.futures</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">a_sync._typing</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">a_sync.primitives.queue</span> <span class="kn">import</span> <span class="n">Queue</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<div class="viewcode-block" id="exhaust_iterator">
<a class="viewcode-back" href="../../../source/a_sync.utils.html#a_sync.exhaust_iterator">[docs]</a>
<span class="k">async</span> <span class="k">def</span> <span class="nf">exhaust_iterator</span><span class="p">(</span><span class="n">iterator</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">queue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Description:</span>
<span class="sd">        Asynchronously iterates over items from the given async iterator and optionally places them into a queue.</span>
<span class="sd">    </span>
<span class="sd">        This function is a utility to exhaust an async iterator, with an option to forward the iterated items to a provided asyncio.Queue. It&#39;s particularly useful when dealing with asynchronous operations that produce items to be consumed by other parts of an application, enabling a producer-consumer pattern.</span>

<span class="sd">    Args:</span>
<span class="sd">        iterator (AsyncIterator[T]): The async iterator to exhaust.</span>
<span class="sd">        queue (Optional[asyncio.Queue]): An optional queue where iterated items will be placed. If None, items are simply consumed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">queue</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;putting </span><span class="si">%s</span><span class="s1"> from </span><span class="si">%s</span><span class="s1"> to queue </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">thing</span><span class="p">,</span> <span class="n">iterator</span><span class="p">,</span> <span class="n">queue</span><span class="p">)</span>
            <span class="n">queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="exhaust_iterators">
<a class="viewcode-back" href="../../../source/a_sync.utils.html#a_sync.exhaust_iterators">[docs]</a>
<span class="k">async</span> <span class="k">def</span> <span class="nf">exhaust_iterators</span><span class="p">(</span><span class="n">iterators</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">queue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;    </span>
<span class="sd">    Description:</span>
<span class="sd">        Asynchronously iterates over multiple async iterators concurrently and optionally places their items into a queue.</span>
<span class="sd">    </span>
<span class="sd">        This function leverages asyncio.gather to concurrently exhaust multiple async iterators. It&#39;s useful in scenarios where items from multiple async sources need to be processed or collected together, supporting concurrent operations and efficient multitasking.</span>

<span class="sd">    Args:</span>
<span class="sd">        iterators: A sequence of async iterators to be exhausted concurrently.</span>
<span class="sd">        queue (Optional[asyncio.Queue]): An optional queue where items from all iterators will be placed. If None, items are simply consumed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">exhaust_iterator</span><span class="p">(</span><span class="n">iterator</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="n">queue</span><span class="p">)</span> <span class="k">for</span> <span class="n">iterator</span> <span class="ow">in</span> <span class="n">iterators</span><span class="p">])</span> 
    <span class="k">if</span> <span class="n">queue</span><span class="p">:</span>
        <span class="n">queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">(</span><span class="n">_Done</span><span class="p">())</span></div>

    
<span class="n">T0</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T0&#39;</span><span class="p">)</span>
<span class="n">T1</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T1&#39;</span><span class="p">)</span>
<span class="n">T2</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T2&#39;</span><span class="p">)</span>
<span class="n">T3</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T3&#39;</span><span class="p">)</span>
<span class="n">T4</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T4&#39;</span><span class="p">)</span>
<span class="n">T5</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T5&#39;</span><span class="p">)</span>
<span class="n">T6</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T6&#39;</span><span class="p">)</span>
<span class="n">T7</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T7&#39;</span><span class="p">)</span>
<span class="n">T8</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T8&#39;</span><span class="p">)</span>
<span class="n">T9</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T9&#39;</span><span class="p">)</span>

<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">as_yielded</span><span class="p">(</span><span class="o">*</span><span class="n">iterators</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span><span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">as_yielded</span><span class="p">(</span><span class="n">iterator0</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T0</span><span class="p">],</span> <span class="n">iterator1</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T1</span><span class="p">],</span> <span class="n">iterator2</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T2</span><span class="p">],</span> <span class="n">iterator3</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T3</span><span class="p">],</span> <span class="n">iterator4</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T4</span><span class="p">],</span> <span class="n">iterator5</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T5</span><span class="p">],</span> <span class="n">iterator6</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T6</span><span class="p">],</span> <span class="n">iterator7</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T7</span><span class="p">],</span> <span class="n">iterator8</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T8</span><span class="p">],</span> <span class="n">iterator9</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T9</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">T3</span><span class="p">,</span> <span class="n">T4</span><span class="p">,</span> <span class="n">T5</span><span class="p">,</span> <span class="n">T6</span><span class="p">,</span> <span class="n">T7</span><span class="p">,</span> <span class="n">T8</span><span class="p">,</span> <span class="n">T9</span><span class="p">]]:</span><span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">as_yielded</span><span class="p">(</span><span class="n">iterator0</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T0</span><span class="p">],</span> <span class="n">iterator1</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T1</span><span class="p">],</span> <span class="n">iterator2</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T2</span><span class="p">],</span> <span class="n">iterator3</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T3</span><span class="p">],</span> <span class="n">iterator4</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T4</span><span class="p">],</span> <span class="n">iterator5</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T5</span><span class="p">],</span> <span class="n">iterator6</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T6</span><span class="p">],</span> <span class="n">iterator7</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T7</span><span class="p">],</span> <span class="n">iterator8</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T8</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">T3</span><span class="p">,</span> <span class="n">T4</span><span class="p">,</span> <span class="n">T5</span><span class="p">,</span> <span class="n">T6</span><span class="p">,</span> <span class="n">T7</span><span class="p">,</span> <span class="n">T8</span><span class="p">]]:</span><span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">as_yielded</span><span class="p">(</span><span class="n">iterator0</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T0</span><span class="p">],</span> <span class="n">iterator1</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T1</span><span class="p">],</span> <span class="n">iterator2</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T2</span><span class="p">],</span> <span class="n">iterator3</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T3</span><span class="p">],</span> <span class="n">iterator4</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T4</span><span class="p">],</span> <span class="n">iterator5</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T5</span><span class="p">],</span> <span class="n">iterator6</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T6</span><span class="p">],</span> <span class="n">iterator7</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T7</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">T3</span><span class="p">,</span> <span class="n">T4</span><span class="p">,</span> <span class="n">T5</span><span class="p">,</span> <span class="n">T6</span><span class="p">,</span> <span class="n">T7</span><span class="p">]]:</span><span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">as_yielded</span><span class="p">(</span><span class="n">iterator0</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T0</span><span class="p">],</span> <span class="n">iterator1</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T1</span><span class="p">],</span> <span class="n">iterator2</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T2</span><span class="p">],</span> <span class="n">iterator3</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T3</span><span class="p">],</span> <span class="n">iterator4</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T4</span><span class="p">],</span> <span class="n">iterator5</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T5</span><span class="p">],</span> <span class="n">iterator6</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T6</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">T3</span><span class="p">,</span> <span class="n">T4</span><span class="p">,</span> <span class="n">T5</span><span class="p">,</span> <span class="n">T6</span><span class="p">]]:</span><span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">as_yielded</span><span class="p">(</span><span class="n">iterator0</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T0</span><span class="p">],</span> <span class="n">iterator1</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T1</span><span class="p">],</span> <span class="n">iterator2</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T2</span><span class="p">],</span> <span class="n">iterator3</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T3</span><span class="p">],</span> <span class="n">iterator4</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T4</span><span class="p">],</span> <span class="n">iterator5</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T5</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">T3</span><span class="p">,</span> <span class="n">T4</span><span class="p">,</span> <span class="n">T5</span><span class="p">]]:</span><span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">as_yielded</span><span class="p">(</span><span class="n">iterator0</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T0</span><span class="p">],</span> <span class="n">iterator1</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T1</span><span class="p">],</span> <span class="n">iterator2</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T2</span><span class="p">],</span> <span class="n">iterator3</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T3</span><span class="p">],</span> <span class="n">iterator4</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T4</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">T3</span><span class="p">,</span> <span class="n">T4</span><span class="p">]]:</span><span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">as_yielded</span><span class="p">(</span><span class="n">iterator0</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T0</span><span class="p">],</span> <span class="n">iterator1</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T1</span><span class="p">],</span> <span class="n">iterator2</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T2</span><span class="p">],</span> <span class="n">iterator3</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T3</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">T3</span><span class="p">]]:</span><span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">as_yielded</span><span class="p">(</span><span class="n">iterator0</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T0</span><span class="p">],</span> <span class="n">iterator1</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T1</span><span class="p">],</span> <span class="n">iterator2</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T2</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">]]:</span><span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">as_yielded</span><span class="p">(</span><span class="n">iterator0</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T0</span><span class="p">],</span> <span class="n">iterator1</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T1</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">]]:</span><span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">as_yielded</span><span class="p">(</span><span class="n">iterator0</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T0</span><span class="p">],</span> <span class="n">iterator1</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T1</span><span class="p">],</span> <span class="n">iterator2</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T2</span><span class="p">],</span> <span class="o">*</span><span class="n">iterators</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">T</span><span class="p">]]:</span><span class="o">...</span>
<div class="viewcode-block" id="as_yielded">
<a class="viewcode-back" href="../../../source/a_sync.utils.html#a_sync.as_yielded">[docs]</a>
<span class="k">async</span> <span class="k">def</span> <span class="nf">as_yielded</span><span class="p">(</span><span class="o">*</span><span class="n">iterators</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>  <span class="c1"># type: ignore [misc]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Description:</span>
<span class="sd">        Merges multiple async iterators into a single async iterator that yields items as they become available from any of the source iterators.</span>

<span class="sd">        This function is designed to streamline the handling of multiple asynchronous data streams by consolidating them into a single asynchronous iteration context. It enables concurrent fetching and processing of items from multiple sources, improving efficiency and simplifying code structure when dealing with asynchronous operations.</span>

<span class="sd">        The merging process is facilitated by internally managing a queue where items from the source iterators are placed as they are fetched. This mechanism ensures that the merged stream of items is delivered in an order determined by the availability of items from the source iterators, rather than their original sequence.</span>

<span class="sd">    Args:</span>
<span class="sd">        *iterators: Variable length list of AsyncIterator objects to be merged.</span>

<span class="sd">    Returns:</span>
<span class="sd">        AsyncIterator[T]: An async iterator that yields items from the input async iterators as they become available.</span>

<span class="sd">    Note:</span>
<span class="sd">        This implementation leverages asyncio tasks and queues to efficiently manage the asynchronous iteration and merging process. It handles edge cases such as early termination and exception management, ensuring robustness and reliability.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">queue</span><span class="p">:</span> <span class="n">Queue</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span>
        <span class="n">coro</span><span class="o">=</span><span class="n">exhaust_iterators</span><span class="p">(</span><span class="n">iterators</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="n">queue</span><span class="p">),</span> 
        <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;a_sync.as_yielded queue populating task for </span><span class="si">{</span><span class="n">iterators</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_as_yielded_done_callback</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Task</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="o">:=</span> <span class="n">t</span><span class="o">.</span><span class="n">exception</span><span class="p">())</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">next_fut</span><span class="o">.</span><span class="n">done</span><span class="p">():</span> 
            <span class="n">next_fut</span><span class="o">.</span><span class="n">set_exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="n">_as_yielded_done_callback</span><span class="p">)</span>
    
    <span class="k">while</span> <span class="ow">not</span> <span class="n">task</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
        <span class="n">next_fut</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">create_future</span><span class="p">()</span>
        <span class="n">get_task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span>
            <span class="n">coro</span><span class="o">=</span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span> 
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;a_sync.as_yielded </span><span class="si">{</span><span class="n">queue</span><span class="si">}</span><span class="s2"> getter for </span><span class="si">{</span><span class="n">iterators</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># if an exception occurs in this loop we don&#39;t need to see the task destroyed log</span>
        <span class="n">get_task</span><span class="o">.</span><span class="n">_log_destroyed_pending</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">_chain_future</span><span class="p">(</span><span class="n">get_task</span><span class="p">,</span> <span class="n">next_fut</span><span class="p">)</span>  <span class="c1"># type: ignore [attr-defined]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">(</span><span class="k">await</span> <span class="n">next_fut</span><span class="p">,</span> <span class="o">*</span><span class="n">_get_ready</span><span class="p">(</span><span class="n">queue</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">_Done</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="k">yield</span> <span class="n">item</span>
            
    <span class="c1"># ensure it isn&#39;t done due to an exception</span>
    <span class="k">if</span> <span class="n">e</span> <span class="o">:=</span> <span class="n">task</span><span class="o">.</span><span class="n">exception</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">e</span></div>


        
<div class="viewcode-block" id="_Done">
<a class="viewcode-back" href="../../../source/a_sync.utils.html#a_sync._Done">[docs]</a>
<span class="k">class</span> <span class="nc">_Done</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A sentinel class used to signal the completion of processing in the as_yielded function.</span>

<span class="sd">    This class acts as a marker to indicate that all items have been processed and the asynchronous iteration can be concluded. It is used internally within the implementation of as_yielded to efficiently manage the termination of the iteration process once all source iterators have been exhausted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="_get_ready">
<a class="viewcode-back" href="../../../source/a_sync.utils.html#a_sync._get_ready">[docs]</a>
<span class="k">def</span> <span class="nf">_get_ready</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">queue</span><span class="o">.</span><span class="n">get_all_nowait</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">QueueEmpty</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, BobTheBuidler.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>